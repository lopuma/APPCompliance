///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
OS Linux INFRA 7&8_ITSS (noIFSnoPHI)(Split) - Issue REF : 755679 / PRE 18
✍
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
--- IZ.1.1.4.7 Password Requirements

"For the password facility, ensure pam modules are in correct order.
"Hay que revisar el orden del pam_cracklib.so or pam_pwquality, debe ser superior a pam_pwhistory.so, seguido de pam_unix.so , y último pam_deny.so"

cat /etc/pam.d/system-auth | grep -i password

"EJEMPLO
//password    required      pam_cracklib.so o pam_pwquality
//password    sufficient    pam_unix.so
//password    required      pam_deny.so

"Si es Rehl 7 superior, se revisa tambien en password-auth"

cat /etc/*release
##*/
cat /etc/pam.d/password-auth | grep -i password

🗒✔  /* CONTESTAR YES */ : "Si el orden del modulo 'password', en system-auth y password-auth son correctos"
🗒⛔ /* CONTESTAR NO  */ : "Si no tiene el orden que nos pide"
/* NO */			"On /etc/pam.d/system-auth and /etc/pam.d/password-auth , you have configured pam_cracklib.so and pam_pwquality, only 1 must exist, if you cannot cause configuration problems."
🗒🔁 /* CONTESTAR N/A */ : ""
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
--- IZ.1.2.1.4.3 Logging

"Login success or failure, logs to specified files.
"Requerido para los sistemas que usan rsyslog"

ls -la /etc/rsyslog.conf

"Debe tener una de las 2 opciones siguientes"
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
*.info;mail.none;authpriv.none;cron.none                /var/log/messages
authpriv.*                                              /var/log/secure

"or (if you don't want to use global variable $ActionFileDefaultTemplate)

*.info;mail.none;authpriv.none;cron.none /var/log/messages;RSYSLOG_TraditionalFileFormat
authpriv.* /var/log/secure;RSYSLOG_TraditionalFileFormat

"Comprobar
cat /etc/rsyslog.conf |grep -v "#" |egrep "Action|secure|messages|RSYSLOG"

🗒✔  /* CONTESTAR YES */ : "Si en /etc/rsyslog.conf encontramos: lo indicado en Recommended Setting"
🗒⛔ /* CONTESTAR NO  */ : ""
🗒🔁 /* CONTESTAR N/A */ : "Si el sistema no utiliza /etc/rsyslog.conf"
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
--- IZ.1.2.2 Logging

" /var/log/wtmp

ls -la /var/log/wtmp

🗒✔  /* CONTESTAR YES */ : "Si existe /var/log/wtmp"
🗒⛔ /* CONTESTAR NO  */ : ""
🗒🔁 /* CONTESTAR N/A */ : ""
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
IZ.1.4.6.6 System Settings	

"Login shell which supports time out

//primero declarar una variable con las shell a comprobar
Shells='/bin/csh|/bin/tcsh|/bin/sh|/bin/ksh|/bin/bash|/bin/sh|/bin/false|/sbin/nologin|/usr/bin/sh|/usr/bin/bash|/usr/sbin/nologin|/bin/ksh93|/usr/bin/ksh|/usr/bin/rksh|/usr/bin/ksh93|'

//Segundo debemos comprobar que en /etc/passwd, no tenga las shell de sync, shutdown etc etc, como menciona en el siguiente codigo.
"HAY QUE COPIAR EL CODIGO ENTERO.
cat /etc/passwd | egrep -v '^sync:.*:/bin/sync\s*$|^halt:.*:/sbin/halt\s*$|^shutdown:.*:/sbin/shutdown\s*$' |
while read ENTRY
do
SHELL=$(echo $ENTRY | awk -F: '{printf $7"\n"}')
Uid=$(echo $ENTRY | awk -F: '{printf $1"\n"}')
[[ "$SHELL" != @($Shells) ]] && printf " WARNING: Verify shell supports autologout/TMOUT function - id: $Uid - shell: $SHELL\n"
done


"🗒✔  CONTESTAR YES */ : "Si retorna vacio."
"🗒⛔ CONTESTAR NO  */ : ""
"🗒🔁 CONTESTAR N/A */ : ""
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
---IZ.1.5.9.24.4.1 Network Settings

"Configure vsftpd service where secure ftp is permitted. Purchased Cert. Option 1
"Si vsftpd esta activo ver recommended settings"

systemctl status vsftpd
systemctl list-units --all --state=active | grep -i vsftpd

🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎🔎
##Configuracion de recommended settings
"El archivo /etc/vsftpd/vsftpd.conf # debe existir con permisos de 600, si vsftpd es activo.
ls -l /etc/vsftpd/vsftpd.conf

"Y debe contener las siguiente configuraciones ver recommended settings"
cat /etc/vsftpd/vsftpd.conf | grep -v '^\s*#' | egrep 'ssl_enable|allow_anon_ssl|force_local_|ssl_|rsa_'

" y los archivos rsa_ * existen y tienen permisos de 600.
"rsa_cert_file=/etc/pki/tls/certs/$pemFileName
"rsa_private_key_file=/etc/pki/tls/private

ls -l /etc/pki/tls/certs/$pemFileName
ls -l /etc/pki/tls/private/$keyFileName

/*🗒✔  CONTESTAR YES */ : "SI ESTA ACTIVO vsftpd, y al revisar LA CONFIGURACION ES CORRECTA"
/*🗒🔁 CONTESTAR N/A */ : "SI vsftpd NO ESTA ACTIVO"
/*N/A*/                   	"Unit vsftpd.service could not be found"
/*🗒⛔ CONTESTAR NO  */ : ""
/*NO*/                          ""
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
---IZ.1.5.9.24.4.2 Network Settings

"Configure vsftpd service where secure ftp is permitted. Self-signed. Option 2

//Lo mismo que ---IZ.1.5.9.24.4.1 Network Settings"

/*🗒🔁 CONTESTAR N/A */ : "SI vsftpd NO ESTA ACTIVO"
/*N/A*/                         "Unit vsftpd.service could not be found"
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
---IZ.1.5.13.1 Network Settings
"Ensure core dumps are restricted

Set 'hard core' ulimit to '0'.
O
Set fs.suid_dumpable to '0'.

"SI fs.suid_dumpable to 0" // Contestar Yes
sysctl fs.suid_dumpable
grep ""fs\.suid_dumpable"" /etc/sysctl.conf /etc/sysctl.d/*.conf | sort -V

#*/

"En caso contrario revisar que cumpla una de las 3 opciones siguientes "
//Existen varias opciones de definir el valor
⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙
" Opcion 1: Ulimit a traves del archivo de configuracion:
" YES si esta definido en /etc/security/limits.conf"

cat /etc/security/limits.conf  | egrep -i "hard|core|ulimit"
egrep -i "hard|core|ulimit" /etc/security/limits.conf /etc/security/limits.d/* | sort -V

#*/
⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙
" Opcion 2: Configuracion Ulimit via perfiles.
" Yes si está definido ulimit a 0, en la configuracion de profile o en archivo personalizado disable-coredumps.sh "

cat  /etc/profile | egrep -i "hard|core|ulimit"
cat  /etc/profile.d/disable-coredumps.sh

⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙⚙
" Opcion 3: Ulimit a traves de systemd 
" Contestamos Yes si systemd-coredump service esta activo y la configuracion es correcta
cat /etc/services | egrep -i "systemd|coredump"
systemctl status systemd-coredump
systemctl list-units --all --state=active | grep -i coredump

⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇⬇
#"Revisar la siguente configuracion
"Deben existir estos fichero y dentro debe estar configurado Storage=none, ProcessSizeMax=0
ls -la /etc/systemd/coredump.conf 
ls -la /etc/systemd/coredump.conf.d/*.conf 
ls -la /run/systemd/coredump.conf.d/*.conf 
ls -la /usr/lib/systemd/coredump.conf.d/*.conf

#*/

grep Storage /etc/systemd/coredump.conf /etc/systemd/coredump.conf.d/*.conf /run/systemd/coredump.conf.d/*.conf /usr/lib/systemd/coredump.conf.d/*.conf
#*/
grep ProcessSizeMax /etc/systemd/coredump.conf /etc/systemd/coredump.conf.d/*.conf /run/systemd/coredump.conf.d/*.conf /usr/lib/systemd/coredump.conf.d/*.conf

🗒✔  /* CONTESTAR YES */ : "SI fs.suid_dumpable to 0"
🗒⛔ /* CONTESTAR NO  */ : ""
🗒🔁 /* CONTESTAR N/A */ : ""
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
---IZ.1.5.13.2 Network Settings
"Ensure address space layout randomization (ASLR) is enabled

"Debe existir" kernel.randomize_va_space = 2

#Comandos
sysctl kernel.randomize_va_space
grep randomize_va_space /etc/sysctl.conf /etc/sysctl.d/*.conf | sort -V

/*🗒✔  CONTESTAR YES */ : "Si existe 'kernel.randomize_va_space = 2'"
/*🗒🔁 CONTESTAR N/A */ : ""
/*N/A*/                         ""
/*🗒⛔ CONTESTAR NO  */ : ""
/*NO*/                          ""
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
---IZ.C.1.1.2 Filesystem Configuration	Ensure separate partition exists for /tmp
---IZ.C.1.1.6 Filesystem Configuration	Ensure separate partition exists for /var
---IZ.C.1.1.7 Filesystem Configuration	Ensure separate partition exists for /var/tmp
---IZ.C.1.1.11 Filesystem Configuration	Ensure separate partition exists for /var/log
---IZ.C.1.1.12 Filesystem Configuration	Ensure separate partition exists for /var/log/audit
---IZ.C.1.1.13 Filesystem Configuration	Ensure separate partition exists for /home
---IZ.C.1.1.14 Filesystem Configuration	Ensure nodev option set on /home partition
---IZ.C.1.6.1.5 Mandatory Access Control	Ensure the MCS Translation Service (mcstrans) is not installed
---IZ.C.4.1.3 Configure System Accounting	Ensure auditing for processes that start prior to auditd is enabled
---IZ.C.6.2.6 User and Group Settings	Ensure root PATH Integrity in the default root environment

" For IFS (Internet Facing Systems), create directory as a separate partition.

🗒✔  /* CONTESTAR YES */ : ""
🗒⛔ /* CONTESTAR NO  */ : ""
🗒🔁 /* CONTESTAR N/A */ : "For IFS (Internet Facing Systems)"
##----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------##
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
