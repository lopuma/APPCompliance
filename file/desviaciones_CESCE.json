[
    {
        "modulo": "Protecting Resources-OSRs/Log File Restrictions",
        "clave": "WTMP",
        "descripcion": "Invalid Permissions or Ownership for log file: /var/log/wtmp;   -rw-rw-r--.;  owner:  root;   group:  utmp. For more information see rule description.",
        "comprobacion": "## Se le debe quitar W al grupo.\n\n+-------------------------------------------------------------------------------------+\n## Comprobar que en logrotate.conf, tenga permisosa 0644\n+-------------------------------------------------------------------------------------+\n\ncat /etc/logrotate.conf | grep -w wtmp -A4",
        "copia": "## Obtener usuario logueado:\n\nuser=$(logname)\n\n+-------------------------------------------------------------------------------------+\n## Backup con HOME en MAYÚSCULAS\n+-------------------------------------------------------------------------------------+\n\ncp -p /etc/logrotate.conf /home/${user^^}/logrotate.conf_`date +%d%m%y`\n\n+-------------------------------------------------------------------------------------+\n## Backup con HOME en minúsculas\n+-------------------------------------------------------------------------------------+\n\ncp -p /etc/logrotate.conf /home/${user,,}/logrotate.conf_`date +%d%m%y`",
        "editar": "+-------------------------------------------------------------------------------------+\n## Quitar permisos\n+-------------------------------------------------------------------------------------+\n\nchmod g-w /var/log/wtmp\n\n+-------------------------------------------------------------------------------------+\n## Dejar esta linea para REHL 7:\n+-------------------------------------------------------------------------------------+\n\n## Editar:\n\nvi /lib/tmpfiles.d/var.conf\n\n## Debe quedar la linea asi:\n\nf /var/log/wtmp 0644 root utmp -\n\n+-------------------------------------------------------------------------------------+\n## Dejar esta linea para REHL 6\n+-------------------------------------------------------------------------------------+\n\n## Editar:\n\nvi /etc/rc.sysinit\n\n## Dejar la linea asi:\n\nchmod 0644 /var/run/utmp /var/log/wtmp\n\n+-------------------------------------------------------------------------------------+\n## Corregir los permisos en logrotate.conf, en create de wtmp\n+-------------------------------------------------------------------------------------+\n\nvi /etc/logrotate.conf\n\n+-------------------------------------------------------------------------------------+\n## Modificar los permisos de 0664, a 0644, al fichero /var/log/wtmp\n+-------------------------------------------------------------------------------------+",
        "refrescar": null,
        "evidencia": "clear\ndate\nhostname\nls -la /var/log/wtmp\ncat /lib/tmpfiles.d/var.conf | grep -w wtmp\ncat /etc/logrotate.conf | grep -w wtmp -A4",
        "SO": "Linux"
    },
    {
        "modulo": "Password Requirements/Private Key File Restriction",
        "clave": "AUTHORIZED_KEY",
        "descripcion": "SSH authorized_keys file: \"FICHERO AUTHORIZED KEYS\"; Invalid from section: . \"*º\" or \"*.*.*.*\" or \"0/0\" or \"0.0.0.0/0\" or empty are forbidden values in the \"from=\" parameter",
        "comprobacion": "+-------------------------------------------------------------------------------------+\n## En este tipo de desviaciones, las claves publicas(\"authorized_keys\")\n## Deben tener un FROM que especifique el host remoto o direccion IP.\n## Antes de seguir, revisar -* AUTHORIZED_KEYS *-\n\n+-------------------------------------------------------------------------------------+\n## Revisamos si tiene un FROM, que especifica el host remoto o IP\n## Debe ser solo accesible al owner\n+-------------------------------------------------------------------------------------+\n\nls -la $file_authorized\ncat $file_authorized\n\n## PUEDEN EXISTIR 3 OPCIONES DIFERENTES:\n\n## --> OPCION 1\n+-------------------------------------------------------------------------------------+\n## Si el fichero authorized_keys es de root, no debe tener un fichero authorized_keys.\n## Pasamos directamente a renombrar el fichero authorized_keys para owner root.\n## ('SI HAY DUDAS, consultarlo con el tecnico')\n+-------------------------------------------------------------------------------------+\n\n## --> OPCION 2\n+-------------------------------------------------------------------------------------+\n## Si el fichero authorized_keys, pertenece a otro owner o grupo que no sea root.\n## Si es de TIPO /F/ o /S/ (sistemas / aplicativo)\n## se debe contactar con el owner o grupo del fichero.\n## - Si se va a excepcionar nos deben especificar un RISK e IMPACT.\n\n## - Si se va a corregir.\n## Revisar ('authorized_keys'), antes de cualquier cambio.\n\n## Si es de TIPO /C/ (customer)\n## - Se debe excepcionar.\n## Por favor revisar la sección de RISK e IMPACT.\n+-------------------------------------------------------------------------------------+\n\n## --> OPCION 3\n+-------------------------------------------------------------------------------------+\n## Si el fichero authorized_keys, pertenece a otro owner o grupo que no sea root.\n## SI es de tipo /E/. /I/\n## - Si es una cuenta 'externa' y no existe en el servidor, se puede renombrar.\n## - Si la cuenta existe, se debe notificar al owner de la cuenta.\n\n## Se le debe notificar que se ha renombrado el fichero y que si lo utiliza debe,\n## Crear un fichero authorized_keys con un \"from=\" con host especifico o IP. \n## Revisar ('AUTHORIZED_KEYS'), antes de cualquier cambio.\n+-------------------------------------------------------------------------------------+",
        "copia": "+-------------------------------------------------------------------------------------+\n## Obtener usuario logueado:\n+-------------------------------------------------------------------------------------+\n\nuser=$(logname)\n\n## LINUX\n+-------------------------------------------------------------------------------------+\n## Backup con HOME en MAYÚSCULAS\n+-------------------------------------------------------------------------------------+\n\ncp -p $file_authorized /home/${user^^}/authorized_key_`date +%d%m%y_%T`\n\n+-------------------------------------------------------------------------------------+\n## Backup con HOME en minúsculas\n+-------------------------------------------------------------------------------------+\n\ncp -p $file_authorized /home/${user,,}/authorized_key_`date +%d%m%y_%T`\n\n## AIX\n+-------------------------------------------------------------------------------------+\n## Backup\n+-------------------------------------------------------------------------------------+\ncp -p \"$file_authorized\" /home/$user/authorized_key_`date +%d%m%y_%T`",
        "editar": "## --> OPCION 1\n+-------------------------------------------------------------------------------------+\n## Para ficheros authorized_keys, con owner root.\n+-------------------------------------------------------------------------------------+\n\nmv /home/root/.ssh/authorized_keys /home/root/.ssh/authorized_keys.save\n\n\n## --> OPCION 2 y ## --> OPCION 3\n+-------------------------------------------------------------------------------------+\n## Para otros ficheros authorized_keys.\n## De tipo /F/S/ o sin owner o account externas/internas tipo /E/ o /I/.\n## Donde se tengan que renombar el fichero.\n+-------------------------------------------------------------------------------------+\n\nmv $file_authorized $file_authorized.save\n\n\n## --> OPCION 2 y ## --> OPCION 3\n+-------------------------------------------------------------------------------------+\n## Para otros ficheros authorized_keys.\n## De tipo /F/S/ o sin owner o account externas/internas tipo /E/ o /I/.\n## Donde se tenga que añadir un FROM.\n+-------------------------------------------------------------------------------------+\n\nvi $file_authorized\n\n+-------------------------------------------------------------------------------------+\n## Añadir la línea from=\"IP\", al inicio de cada clave shh-rsa:\n \n## EJEMPLO\n\nfrom=\"129.39.41.5,129.39.41.6\" ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAvTiyIn2JpgAYAIH1UMD5H6VIY3t4HcCQi+yjMvKYLESnz1L4lBWv4icM+BuxAy06mXy4jJiRjwdnkRT2RY4CeR4p0cxV0qnMCzcbBjzq8D8/TO/v95SyAgLo6Ni5xs4tdzBVETfSlyES6mY2sk2t6OCOjJpVJzIJowmfa9b//VfYZyEvpXjhXljHnLTlvrkrun8faHeQWWFNkl5AYDZeSfZzPf8k2ZrJNYRdKWISLjbyBUBuAG2cxGrrNHALqa42hZGCeRwlmxBpzCtX1qCieQuL/dWi9VYFvJQIs0EtQq88z+qoCqJhs2s2XeVtKKR7iFzzaN1MpE93FkyiP5lFFw== icouxat2@es01qih02ir01rm !!CZ/S/*ABJ83/IBM/Automation ID!!\n \n+-------------------------------------------------------------------------------------+",
        "refrescar": null,
        "evidencia": "## --> OPCION 1\n+-------------------------------------------------------------------------------------+\n## Para ficheros authorized_keys, con owner root.\n+-------------------------------------------------------------------------------------+\nclear\ndate\nhostname\nls -la /home/root/.ssh/authorized_keys\n\n\n## --> OPCION 2 y ## --> OPCION 3\n+-------------------------------------------------------------------------------------+\n## Para otros ficheros authorized_keys.\n## De tipo /F/S/ o sin owner o account externas/internas tipo /E/ o /I/\n+-------------------------------------------------------------------------------------+\nclear\ndate\nhostname\nls -la $file_authorized\ncat $file_authorized",
        "SO": "Linux / Aix"
    },
    {
        "modulo": "Password Requirements/Login Retries",
        "clave": "PAM_TALLY",
        "descripcion": "Non of the Login Retrie options was found in file:\n/etc/pam.d/password-auth\n/etc/pam.d/system-auth",
        "comprobacion": "+-------------------------------------------------------------------------------------+\n## Hace referencia al 'pam_tally2.so' en RHEL7, y al 'pam_faillock.so'  en RHEL8.\n+-------------------------------------------------------------------------------------+\n\n## Saber que versión de RHEL es:\ncat /etc/*release\n\n#-*** Saber que PAM_TALLY USA ****-#\nls -ltr /lib64/security/pam_tally*\n\n#-*** Saber que PAM_FAILLOCK USA ****-#\nls -la /usr/sbin/faillock\n\n+-------------------------------------------------------------------------------------+\n##--- RHEL 7('system-auth','password-auth')\n+-------------------------------------------------------------------------------------+\n\n+-------------------------------------------------------------------------------------+\n## Los ficheros del PAM, deben tener en el modulo 'auth required', el parámetro 'pam_tally2.so'\n## Los ficheros del PAM, deben tener en el modulo 'account required', el parámetro 'pam_tally2.so'\n+-------------------------------------------------------------------------------------+\n\ncat /etc/pam.d/system-auth | grep pam_tally\ncat /etc/pam.d/password-auth | grep pam_tally\n\n+-------------------------------------------------------------------------------------+\n##--- RHEL 8 ('system-auth','password-auth')\n+-------------------------------------------------------------------------------------+\n\n+-------------------------------------------------------------------------------------+\n## Los ficheros del PAM, deben tener en el modulo 'auth required', el parámetro 'pam_faillock.so'\n## Los ficheros del PAM, deben tener en el modulo 'account required', el parámetro 'pam_faillock.so'\n+-------------------------------------------------------------------------------------+\n\ncat /etc/pam.d/system-auth | grep pam_faillock.so\ncat /etc/pam.d/password-auth | grep pam_faillock.so",
        "copia": "+-------------------------------------------------------------------------------------+\n## Obtener usuario logueado:\n+-------------------------------------------------------------------------------------+\n\nuser=$(logname)\n\n+-------------------------------------------------------------------------------------+\n## Backup con HOME en MAYÚSCULAS\n+-------------------------------------------------------------------------------------+\n\ncp -p /etc/pam.d/system-auth /home/${user^^}/system-auth_`date +%d%m%y_%T`\n\ncp -p /etc/pam.d/password-auth /home/${user^^}/password-auth_`date +%d%m%y_%T`\n\n+-------------------------------------------------------------------------------------+\n## Backup con HOME en minúsculas\n+-------------------------------------------------------------------------------------+\n\ncp -p /etc/pam.d/system-auth /home/${user,,}/system-auth_`date +%d%m%y_%T`\n\ncp -p /etc/pam.d/password-auth /home/${user,,}/password-auth_`date +%d%m%y_%T`\n",
        "editar": "+-------------------------------------------------------------------------------------+\n##--- RHEL 7 ('system-auth','password-auth')\n+-------------------------------------------------------------------------------------+\n\n+-------------------------------------------------------------------------------------+\n## Añadir en el modulo 'auth required', el parámetro 'pam_tally2.so'\n## Se debe añadir en la primero linea del modulo auth\n## ('se aconseja remplazar la linea del modulo')\n+-------------------------------------------------------------------------------------+\n\nvi /etc/pam.d/system-auth\n\nauth        required      pam_tally2.so deny=5\n\n+-------------------------------------------------------------------------------------+\n## Añadir en el modulo 'account required', el parámetro 'pam_tally2.so'.\n+-------------------------------------------------------------------------------------+\n\n+-------------------------------------------------------------------------------------+\n## Se debe añadir en la primera linea del modulo account.\n## ('se aconseja remplazar la linea del modulo').\n+-------------------------------------------------------------------------------------+\n\naccount     required      pam_tally2.so\n\n+-------------------------------------------------------------------------------------+\n## Lo mismo con 'password-auth'\n+-------------------------------------------------------------------------------------+\n\nvi /etc/pam.d/password-auth\n\n+-------------------------------------------------------------------------------------+\n##--- RHEL 8 ('system-auth','password-auth')\n+-------------------------------------------------------------------------------------+\n\n+-------------------------------------------------------------------------------------+\n## Añadir en el modulo 'auth required', el parámetro 'pam_faillock.so'\n+-------------------------------------------------------------------------------------+\n\n+-------------------------------------------------------------------------------------+\n## Se debe añadir en la primera linea del modulo auth.\n## ('se aconseja remplazar la linea del modulo').\n+-------------------------------------------------------------------------------------+\n\nvi /etc/pam.d/system-auth\n\nauth        required        pam_faillock.so preauth silent deny=5 unlock_time=0\n\n+-------------------------------------------------------------------------------------+\n## Ademas se debe añadir la siguiente linea, por encima de 'auth required pam_deny.so'\n+-------------------------------------------------------------------------------------+\n\nauth        [default=die] pam_faillock.so authfail deny=5 unlock_time=0\n\n+-------------------------------------------------------------------------------------+\n## Añadir en el modulo 'account required', el parámetro 'pam_faillock.so'.\n## Se debe añadir en la primera linea del modulo account.\n## ('se aconseja remplazar la linea del modulo').\n+-------------------------------------------------------------------------------------+\n\naccount     required      pam_faillock.so\n\n+-------------------------------------------------------------------------------------+\n## Lo mismo con 'password-auth'\n+-------------------------------------------------------------------------------------+\n\nvi /etc/pam.d/password-auth\n\n",
        "refrescar": null,
        "evidencia": "+-------------------------------------------------------------------------------------+\n##--- RHEL 7('system-auth','password-auth')\n+-------------------------------------------------------------------------------------+\nclear\ndate;hostname\ncat /etc/*release | grep -i release\ncat /etc/pam.d/system-auth | egrep \"pam_tally\" \ncat /etc/pam.d/password-auth | egrep \"pam_tally\"\n\n+-------------------------------------------------------------------------------------+\n##--- RHEL 8 ('system-auth','password-auth')\n+-------------------------------------------------------------------------------------+\nclear\ndate;hostname\ncat /etc/*release | grep -i release\ncat /etc/pam.d/system-auth | egrep \"pam_faillock\" \ncat /etc/pam.d/password-auth | egrep \"pam_faillock\"",
        "SO": "Linux"
    }
]